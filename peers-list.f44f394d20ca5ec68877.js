(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{153:function(e,t,n){"use strict";t.__esModule=!0;var r,o=n(158),a=(r=o)&&r.__esModule?r:{default:r};t.default=a.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},154:function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}},155:function(e,t,n){var r;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var a=typeof r;if("string"===a||"number"===a)e.push(r);else if(Array.isArray(r)&&r.length){var i=o.apply(null,r);i&&e.push(i)}else if("object"===a)for(var c in r)n.call(r,c)&&r[c]&&e.push(c)}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}()},156:function(e,t,n){e.exports={wrapper:"ioIs",block:"XLh3",button:"qsqy",center:"Sitn",label:"csOE XLh3",input:"Cx4C XLh3"}},158:function(e,t,n){e.exports={default:n(159),__esModule:!0}},159:function(e,t,n){n(160),e.exports=n(9).Object.assign},160:function(e,t,n){var r=n(22);r(r.S+r.F,"Object",{assign:n(161)})},161:function(e,t,n){"use strict";var r=n(77),o=n(162),a=n(163),i=n(79),c=n(78),u=Object.assign;e.exports=!u||n(51)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r}))?function(e,t){for(var n=i(e),u=arguments.length,s=1,l=o.f,d=a.f;u>s;)for(var f,p=c(arguments[s++]),h=l?r(p).concat(l(p)):r(p),y=h.length,v=0;y>v;)d.call(p,f=h[v++])&&(n[f]=p[f]);return n}:u},162:function(e,t){t.f=Object.getOwnPropertySymbols},163:function(e,t){t.f={}.propertyIsEnumerable},164:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(153)),o=u(n(154)),a=u(n(155)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(75)),c=u(n(156));function u(e){return e&&e.__esModule?e:{default:e}}t.default=e=>{let t=e.label,n=e.name,u=e.inputRef,s=e.children;var l=e.className;let d=void 0===l?"":l,f=(0,o.default)(e,["label","name","inputRef","children","className"]);return i.h("div",{class:(0,a.default)(c.default.wrapper,d,{[c.default.center]:!t})},t&&i.h("label",{class:c.default.label,for:n},t),s||i.h("input",(0,r.default)({class:c.default.input,type:"text",name:n,id:n,ref:u},f)))}},165:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(75)),a=n(166),i=(r=a)&&r.__esModule?r:{default:r};t.default=({children:e})=>o.h("div",{class:i.default.container},o.h("div",{class:i.default.bubble},e))},166:function(e,t,n){e.exports={container:"L9Pu",bubble:"mXxa"}},167:function(e,t,n){e.exports={default:n(168),__esModule:!0}},168:function(e,t,n){var r=n(9),o=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},172:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=y(n(153)),o=y(n(157)),a=y(n(154)),i=y(n(155)),c=h(n(75)),u=y(n(164)),s=y(n(165)),l=y(n(173)),d=y(n(82)),f=y(n(156)),p=h(n(174));function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function y(e){return e&&e.__esModule?e:{default:e}}function v(e){let t=e.connectTo,n=(0,a.default)(e,["connectTo"]);return c.h("button",{onClick:function(){t(n)}},n.nickname)}class b extends c.Component{constructor(...e){var t,n,r;return t=n=super(...e),this.state={otherPlayers:[]},this.askedToken=null,this.connectTo=(r=(0,o.default)((function*(e){n.askedToken=e.publicId;const t=n.peerConnection,r=t.createDataChannel("data");r.onopen=function(){n.eventSource.close(),n.props.connectTo(e,r)};const o=yield t.createOffer();yield t.setLocalDescription(o),yield p.sendOffer(e.publicId,o)})),function(e){return r.apply(this,arguments)}),t}componentDidMount(){var e=this;return(0,o.default)((function*(){const t=new RTCPeerConnection;e.peerConnection=t;const n=yield p.discoverPeers(e.props.nickname);var r;e.eventSource=n,t.onicecandidate=function(e){e.candidate&&p.sendIceCandidate(e.candidate)},t.ondatachannel=function(t){n.close(),e.props.connectTo(e.oponent,t.channel)},n.onmessage=(r=(0,o.default)((function*(r){var o=JSON.parse(r.data);const a=o.action,i=o.data,c=o.sender;if("add"===a&&e.setState((function(e){return{otherPlayers:[...e.otherPlayers,i]}})),"iceCandidate"===a)try{yield t.addIceCandidate(new RTCIceCandidate(i))}catch(e){}if("offer"===a){yield t.setRemoteDescription(new RTCSessionDescription(i));const n=yield t.createAnswer();yield t.setLocalDescription(n),e.oponent=e.state.otherPlayers.find((function(e){return e.publicId===c})),yield p.sendAnswer(c,n)}"answer"===a&&c===e.askedToken&&(yield t.setRemoteDescription(new RTCSessionDescription(i))),"remove"===a&&e.setState((function(e){return{otherPlayers:e.otherPlayers.filter((function(e){return e.publicId!==i.publicId}))}})),n.onerror=function(){n.close(),e.setState({otherPlayers:[]})}})),function(e){return r.apply(this,arguments)})}))()}componentWillUnmount(){this.eventSource.close()}render({changeNickname:e},{otherPlayers:t}){const n=0===t.length;return c.h(s.default,null,c.h(u.default,{label:"Other players"},c.h("div",{class:(0,i.default)(l.default.list,{[d.default.centerContent]:n})},n?c.h("div",{class:l.default.loader}):c.h("div",{class:l.default.uList},t.map(e=>c.h(v,(0,r.default)({},e,{connectTo:this.connectTo})))))),c.h(u.default,null,c.h("button",{class:f.default.button,onClick:e},"Change my nickname")))}}t.default=b},173:function(e,t,n){e.exports={list:"X1Fl",loader:"nP8F",spin:"ZMcY",uList:"ispQ"}},174:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.discoverPeers=void 0;var r=i(n(157)),o=i(n(167));t.discoverPeers=(a=(0,r.default)((function*(e){const t=yield s("register",{nickname:e}),n=yield t.json();return u=n.privateId,new EventSource(n.feed)})),function(e){return a.apply(this,arguments)});var a;function i(e){return e&&e.__esModule?e:{default:e}}t.sendIceCandidate=function(e){s("iceCandidate",{iceCandidate:e})},t.sendOffer=function(e,t){s("offer",{description:t,publicId:e})},t.sendAnswer=function(e,t){s("answer",{description:t,publicId:e})};const c=window.SIGNALING_SERVER||`${window.location.origin.replace(/:[0-9]+$/,":3000")}/`;let u;function s(e,t){return fetch(c+e,{method:"POST",body:(0,o.default)({privateId:u,data:t}),headers:{"Content-Type":"application/json; charset=utf-8"},mode:"cors"})}}}]);
//# sourceMappingURL=peers-list.f44f394d20ca5ec68877.js.map