{"version":3,"sources":["webpack:///./node_modules/babel-runtime/core-js/json/stringify.js","webpack:///./node_modules/core-js/library/fn/json/stringify.js","webpack:///./src/pong.jsx","webpack:///./node_modules/babel-runtime/helpers/slicedToArray.js","webpack:///./node_modules/babel-runtime/core-js/is-iterable.js","webpack:///./node_modules/core-js/library/fn/is-iterable.js","webpack:///./node_modules/core-js/library/modules/core.is-iterable.js","webpack:///./node_modules/babel-runtime/core-js/get-iterator.js","webpack:///./node_modules/core-js/library/fn/get-iterator.js","webpack:///./node_modules/core-js/library/modules/core.get-iterator.js","webpack:///./src/pong.scss?9133"],"names":["module","exports","__esModule","core","$JSON","JSON","stringify","it","apply","arguments","preact","p","delta","Ball","pos2D","class","styles","ball","style","left","top","Paddle","pos","paddle","Pong","Component","state","ballPos","oponentPos","playerPos","onTouch","e","preventDefault","touches","length","position","clientX","this","screenWidth","setState","send","updateBallPosition","now","performance","timeDelta","lastNow","ballVelocity","ballPaddleDiff","Math","abs","bVx","num","min","max","sqrt","requestAnimationFrame","gameState","componentWillMount","window","innerWidth","coin","random","props","dataChannel","onmessage","data","rawData","parse","render","_","court","onTouchStart","onTouchMove","_isIterable3","_interopRequireDefault","_getIterator3","obj","default","arr","i","Array","isArray","Object","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","value","err","sliceIterator","TypeError","classof","ITERATOR","Iterators","isIterable","O","hasOwnProperty","anObject","get","getIterator","iterFn","call"],"mappings":"6EAAAA,EAAOC,QAAU,CAAE,QAAW,EAAQ,KAAsCC,YAAY,I,oBCAxF,IAAIC,EAAO,EAAQ,GACfC,EAAQD,EAAKE,OAASF,EAAKE,KAAO,CAAEC,UAAWD,KAAKC,YACxDN,EAAOC,QAAU,SAAmBM,GAClC,OAAOH,EAAME,UAAUE,MAAMJ,EAAOK,a,8GCH1BC,E,wJAAZ,O,IACA,Q,mDAUA,SAASC,EAAEC,GACT,MAAQ,GAAU,IAARA,KAGZ,SAASC,GAAK,MAAEC,IACd,OACE,WAAKC,MAAOC,UAAOC,MACjB,WAAKC,MAAO,CAAEC,KAAMR,EAAEG,EAAM,IAAKM,IAAKT,EAAEG,EAAM,QAKpD,SAASO,GAAO,IAAEC,IAChB,OACE,WAAKP,MAAOC,UAAOO,QACjB,WAAKL,MAAO,CAAEC,KAAMR,EAAEW,OAQb,MAAME,UAAad,EAAOe,UAAU,kDACjDC,MAAQ,CACNC,QAAS,CAAC,GAAK,IACfC,WAAY,GACZC,UAAW,IAJoC,KAkCjDC,QAAWC,IAET,GADAA,EAAEC,iBACED,EAAEE,QAAQC,OAAS,EAAG,CACxB,MAAMC,EAAWJ,EAAEE,QAAQ,GAAGG,QAAUC,KAAKC,YAC7CD,KAAKE,SAAS,CAAEV,UAAWM,IAC3BE,KAAKG,KAAK,CAAEL,eAvCiC,KA2CjDM,mBAAqB,KACnB,MAAMC,EAAMC,YAAYD,MAClBE,GAAaF,GAAOL,KAAKQ,SAAWH,IAAQ,IAElDL,KAAKE,SAAS,EAAGZ,UAASE,iBACpBF,EAAQ,IAAM,GAAKA,EAAQ,IAAM,KACnCU,KAAKS,aAAa,KAAO,GAG3B,MAAMC,EAAiBpB,EAAQ,GAAKE,EAEpC,GAAIF,EAAQ,IAAM,GAAKqB,KAAKC,IAAIF,GArFjB,GAqFiD,OACvDG,GADuD,aAChDb,KAAKS,aAD2C,MAE9DT,KAAKS,aAAa,IAnFXK,EAmFsBD,EAAOH,EAvFvB,GAIDK,GAFQ,IAEHC,EAFG,IAGnBL,KAAKK,IAAID,EAAKJ,KAAKI,IAAID,EAAKE,KAmF7BhB,KAAKS,aAAa,GAAKE,KAAKM,KAAK,SAvFnB,GAuFqC,GAAlB,SAAwBJ,EAAO,IAChEb,KAAKG,KAAK,CAAEM,aAAcT,KAAKS,eAC/BT,KAAKS,aAAa,KAAO,EAtFjC,IAAeK,EAAKC,EAAKC,EAyFnB,MAAO,CACL1B,QAAS,CACPA,EAAQ,GAAMU,KAAKS,aAAa,GAAKF,EACrCjB,EAAQ,GAAMU,KAAKS,aAAa,GAAKF,MAK3CP,KAAKQ,QAAUH,EACfa,sBAAsBlB,KAAKI,qBAvEoB,KA8EjDK,aAAe,CAAC,EAAG,GA9E8B,KA+EjDU,UAlFkB,EAG+B,EAOjDC,qBACEpB,KAAKC,YAAcoB,OAAOC,WAE1B,MAAMC,EAAOZ,KAAKa,SAElBxB,KAAKyB,MAAMC,YAAYC,UAAY,EAAGC,KAAMC,MAC1C,MAAMD,EAAO5D,KAAK8D,MAAMD,GAhBV,IAkBV7B,KAAKmB,WAA6BS,EAAKL,OACzCvB,KAAKS,aAAa,GA9CJ,GA8CS,UAAG,EAAOc,EAAOK,EAAKL,MAC7CvB,KAAKmB,UAnBM,EAoBXD,sBAAsBlB,KAAKI,qBAGzBwB,EAAKnB,eACPT,KAAKE,SAAS,EAAGZ,cAAH,CAAoBA,QAAS,CAACA,EAAQ,GAAI,MACxDU,KAAKS,aAAemB,EAAKnB,cAGvBmB,EAAK9B,UACPE,KAAKE,SAAS,CAAEX,WAAYqC,EAAK9B,YAIrCE,KAAKG,KAAK,CAAEoB,SA2CdpB,KAAKyB,GACH5B,KAAKyB,MAAMC,YAAYvB,MAAK,aAAeyB,IAM7CG,OAAOC,GAAG,WAAEzC,EAAF,UAAcC,EAAd,QAAyBF,IACjC,OACE,WACEZ,MAAOC,UAAOsD,MACdC,aAAclC,KAAKP,QACnB0C,YAAanC,KAAKP,SAElB,IAACT,EAAD,CAAQC,IAAKM,IACb,IAACf,EAAD,CAAMC,MAAOa,IACb,IAACN,EAAD,CAAQC,IAAKO,M,UA1FAL,G,iCChCrBvB,EAAQC,YAAa,EAErB,IAEIuE,EAAeC,EAFA,EAAQ,MAMvBC,EAAgBD,EAFA,EAAQ,MAI5B,SAASA,EAAuBE,GAAO,OAAOA,GAAOA,EAAI1E,WAAa0E,EAAM,CAAEC,QAASD,GAEvF3E,EAAQ4E,QA2BC,SAAUC,EAAKC,GACpB,GAAIC,MAAMC,QAAQH,GAChB,OAAOA,EACF,IAAI,EAAIL,EAAaI,SAASK,OAAOJ,IAC1C,OA9BJ,SAAuBA,EAAKC,GAC1B,IAAII,EAAO,GACPC,GAAK,EACLC,GAAK,EACLC,OAAKC,EAET,IACE,IAAK,IAA0CC,EAAtCC,GAAK,EAAId,EAAcE,SAASC,KAAYM,GAAMI,EAAKC,EAAGC,QAAQC,QACzER,EAAKS,KAAKJ,EAAGK,QAETd,GAAKI,EAAKjD,SAAW6C,GAHuDK,GAAK,IAKvF,MAAOU,GACPT,GAAK,EACLC,EAAKQ,EACL,QACA,KACOV,GAAMK,EAAW,QAAGA,EAAW,SACpC,QACA,GAAIJ,EAAI,MAAMC,GAIlB,OAAOH,EAOEY,CAAcjB,EAAKC,GAE1B,MAAM,IAAIiB,UAAU,0D,oBC/C1BhG,EAAOC,QAAU,CAAE,QAAW,EAAQ,KAAmCC,YAAY,I,oBCArF,EAAQ,IACR,EAAQ,IACRF,EAAOC,QAAU,EAAQ,M,oBCFzB,IAAIgG,EAAU,EAAQ,IAClBC,EAAW,EAAQ,EAAR,CAAkB,YAC7BC,EAAY,EAAQ,IACxBnG,EAAOC,QAAU,EAAQ,GAAWmG,WAAa,SAAU7F,GACzD,IAAI8F,EAAInB,OAAO3E,GACf,YAAuBgF,IAAhBc,EAAEH,IACJ,eAAgBG,GAEhBF,EAAUG,eAAeL,EAAQI,M,oBCRxCrG,EAAOC,QAAU,CAAE,QAAW,EAAQ,KAAoCC,YAAY,I,oBCAtF,EAAQ,IACR,EAAQ,IACRF,EAAOC,QAAU,EAAQ,M,oBCFzB,IAAIsG,EAAW,EAAQ,GACnBC,EAAM,EAAQ,IAClBxG,EAAOC,QAAU,EAAQ,GAAWwG,YAAc,SAAUlG,GAC1D,IAAImG,EAASF,EAAIjG,GACjB,GAAqB,mBAAVmG,EAAsB,MAAMV,UAAUzF,EAAK,qBACtD,OAAOgG,EAASG,EAAOC,KAAKpG,M,oBCJ9BP,EAAOC,QAAU,CAAC,KAAO,OAAO,MAAQ,OAAO,OAAS","file":"pong.c7f78591bbf4f8befca3.js","sourcesContent":["module.exports = { \"default\": require(\"core-js/library/fn/json/stringify\"), __esModule: true };","var core = require('../../modules/_core');\nvar $JSON = core.JSON || (core.JSON = { stringify: JSON.stringify });\nmodule.exports = function stringify(it) { // eslint-disable-line no-unused-vars\n  return $JSON.stringify.apply($JSON, arguments);\n};\n","import * as preact from 'preact';\nimport styles from './pong.scss';\n\nconst PADDLE_WIDTH = 0.2;\nconst BALL_VELOCITY = 0.5;\nconst MAX_BALL_VELOCITY_X = 0.9 * BALL_VELOCITY;\n\nfunction clamp(num, min, max) {\n  return Math.max(min, Math.min(num, max));\n}\n\nfunction p(delta) {\n  return `${delta * 100}%`;\n}\n\nfunction Ball({ pos2D }) {\n  return (\n    <div class={styles.ball}>\n      <div style={{ left: p(pos2D[0]), top: p(pos2D[1]) }} />\n    </div>\n  );\n}\n\nfunction Paddle({ pos }) {\n  return (\n    <div class={styles.paddle}>\n      <div style={{ left: p(pos) }} />\n    </div>\n  );\n}\n\nconst STATE_START = 1;\nconst STATE_LOOP = 2;\n\nexport default class Pong extends preact.Component {\n  state = {\n    ballPos: [0.5, 0.5],\n    oponentPos: 0.5,\n    playerPos: 0.5,\n  };\n\n  componentWillMount() {\n    this.screenWidth = window.innerWidth;\n\n    const coin = Math.random();\n\n    this.props.dataChannel.onmessage = ({ data: rawData }) => {\n      const data = JSON.parse(rawData);\n\n      if (this.gameState === STATE_START && data.coin) {\n        this.ballVelocity[1] = ((-1) ** (coin > data.coin)) * BALL_VELOCITY;\n        this.gameState = STATE_LOOP;\n        requestAnimationFrame(this.updateBallPosition);\n      }\n\n      if (data.ballVelocity) {\n        this.setState(({ ballPos }) => ({ ballPos: [ballPos[0], 0] }));\n        this.ballVelocity = data.ballVelocity;\n      }\n\n      if (data.position) {\n        this.setState({ oponentPos: data.position });\n      }\n    };\n\n    this.send({ coin });\n  }\n\n  onTouch = (e) => {\n    e.preventDefault();\n    if (e.touches.length > 0) {\n      const position = e.touches[0].clientX / this.screenWidth;\n      this.setState({ playerPos: position });\n      this.send({ position });\n    }\n  }\n\n  updateBallPosition = () => {\n    const now = performance.now();\n    const timeDelta = (now - (this.lastNow || now)) / 1000;\n\n    this.setState(({ ballPos, playerPos }) => {\n      if (ballPos[0] >= 1 || ballPos[0] <= 0) {\n        this.ballVelocity[0] *= -1;\n      }\n\n      const ballPaddleDiff = ballPos[0] - playerPos;\n      const maxX = MAX_BALL_VELOCITY_X;\n      if (ballPos[1] >= 1 && Math.abs(ballPaddleDiff) < PADDLE_WIDTH) {\n        const [bVx] = this.ballVelocity;\n        this.ballVelocity[0] = clamp(bVx + (ballPaddleDiff / PADDLE_WIDTH), -maxX, maxX);\n        this.ballVelocity[1] = Math.sqrt((BALL_VELOCITY ** 2) - (bVx ** 2));\n        this.send({ ballVelocity: this.ballVelocity });\n        this.ballVelocity[1] *= -1;\n      }\n\n      return {\n        ballPos: [\n          ballPos[0] + (this.ballVelocity[0] * timeDelta),\n          ballPos[1] + (this.ballVelocity[1] * timeDelta),\n        ],\n      };\n    });\n\n    this.lastNow = now;\n    requestAnimationFrame(this.updateBallPosition);\n  }\n\n  send(data) {\n    this.props.dataChannel.send(JSON.stringify(data));\n  }\n\n  ballVelocity = [0, 0];\n  gameState = STATE_START;\n\n  render(_, { oponentPos, playerPos, ballPos }) {\n    return (\n      <div\n        class={styles.court}\n        onTouchStart={this.onTouch}\n        onTouchMove={this.onTouch}\n      >\n        <Paddle pos={oponentPos} />\n        <Ball pos2D={ballPos} />\n        <Paddle pos={playerPos} />\n      </div>\n    );\n  }\n}\n","\"use strict\";\n\nexports.__esModule = true;\n\nvar _isIterable2 = require(\"../core-js/is-iterable\");\n\nvar _isIterable3 = _interopRequireDefault(_isIterable2);\n\nvar _getIterator2 = require(\"../core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = (0, _getIterator3.default)(arr), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if ((0, _isIterable3.default)(Object(arr))) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();","module.exports = { \"default\": require(\"core-js/library/fn/is-iterable\"), __esModule: true };","require('../modules/web.dom.iterable');\nrequire('../modules/es6.string.iterator');\nmodule.exports = require('../modules/core.is-iterable');\n","var classof = require('./_classof');\nvar ITERATOR = require('./_wks')('iterator');\nvar Iterators = require('./_iterators');\nmodule.exports = require('./_core').isIterable = function (it) {\n  var O = Object(it);\n  return O[ITERATOR] !== undefined\n    || '@@iterator' in O\n    // eslint-disable-next-line no-prototype-builtins\n    || Iterators.hasOwnProperty(classof(O));\n};\n","module.exports = { \"default\": require(\"core-js/library/fn/get-iterator\"), __esModule: true };","require('../modules/web.dom.iterable');\nrequire('../modules/es6.string.iterator');\nmodule.exports = require('../modules/core.get-iterator');\n","var anObject = require('./_an-object');\nvar get = require('./core.get-iterator-method');\nmodule.exports = require('./_core').getIterator = function (it) {\n  var iterFn = get(it);\n  if (typeof iterFn != 'function') throw TypeError(it + ' is not iterable!');\n  return anObject(iterFn.call(it));\n};\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"ball\":\"NAeP\",\"court\":\"rX1Z\",\"paddle\":\"ZC15\"};"],"sourceRoot":""}